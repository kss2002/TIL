## 📅 2025-08-30

### 📌 오늘 배운 것

> **프론트엔드-백엔드 API 연동 완전 가이드**

## 📋 프로젝트 개요

- **프론트엔드 개발자**가 백엔드팀과 협업하여 크롤링 데이터 연동
- **API 엔드포인트**: `GET /api/benefits` (멋사) - 앞으로 협업 할때에는 도메인은 계속 바뀐다.
- **백엔드 도메인**: `domo.syu-likelion.org` (멋사) - 앞으로 협업 할때에는 도메인은 계속 바뀐다.
- **프론트엔드 환경**: React + Vite (localhost:5173)

## 🔧 API 명세서 분석

### 혜택찾기 목록 API

```
URL: GET {BASE}/api/benefits
```

**요청 파라미터**

- `search`: "시 군" 형태 (예: "서울 강남")
- `sort`: `benefit` | `popular`
  - `benefit`: 할인율 내림차순 → 인기도 내림차순
  - `popular`: 인기도 내림차순 → 할인율 내림차순
- `page`: 1부터 시작

**페이징 정책**

- `pageSize`: 고정 20개
- `totalPages`: 최대 5페이지

**응답 구조**

```json
{
  "data": {
    "items": [
      {
        "placeId": "...",
        "name": "...",
        "discountPercent": 20,
        "popularity": 15,
        "address": "...",
        "lat": 0.0,
        "lng": 0.0
      }
    ],
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  }
}
```

## ❌ 발생한 문제들과 해결 과정

### 1. 초기 네트워크 에러 (403 Forbidden)

**문제**: API 엔드포인트 자체에 접근할 수 없음
**원인**: 서버 설정 또는 엔드포인트 미구현
**해결**: 백엔드팀과 소통하여 API 상태 확인

### 2. CORS (Cross-Origin Resource Sharing) 에러

**문제**: 브라우저에서 다른 도메인 API 요청 차단

```
Access to XMLHttpRequest at 'https://domo.syu-likelion.org/api/benefits'
from origin 'http://localhost:5173' has been blocked by CORS policy

```

**원인**

- 백엔드에서 CORS 헤더 설정 누락
- `Access-Control-Allow-Origin` 헤더 부재

**필요한 백엔드 CORS 설정**

```
Access-Control-Allow-Origin: http://localhost:5173
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Accept
```

### 3. Preflight 요청 문제

**문제**: POST 요청 시 OPTIONS preflight 요청 차단
**해결**: GET 방식으로 변경 (API 명세서에 맞음)

### 4. HTTP vs HTTPS Origin 차이

**핵심 발견**: 로컬에서는 실패, 배포에서는 성공하는 현상

**원인 분석**

- 로컬 개발환경: `http://localhost:5173` (HTTP Origin)
- 배포 환경: `https://your-domain.com` (HTTPS Origin)
- 백엔드 CORS 설정이 HTTPS Origin만 허용

## 🛠️ 최종 구현 코드

### config.js

```jsx
import axios from 'axios';

// 환경별 API URL 설정
const API_BASE_URL =
  process.env.NODE_ENV === 'production'
    ? 'https://domo.syu-likelion.org' // 프로덕션: 직접 요청
    : ''; // 개발환경: 프록시 사용

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
    Accept: 'application/json',
  },
});

// 디버깅용 인터셉터
apiClient.interceptors.request.use(
  (config) => {
    console.log('API 요청:', {
      method: config.method,
      url: config.url,
      params: config.params,
    });
    return config;
  },
  (error) => Promise.reject(error)
);

// API 함수
export const fetchBenefits = async (params = {}) => {
  try {
    const { search = '', sort = 'benefit', page = 1 } = params;

    const response = await apiClient.get('/api/benefits', {
      params: { search, sort, page },
    });

    return response.data;
  } catch (error) {
    console.error('API 요청 실패:', error);

    // 개발 중 임시 데이터 (CORS 에러 시)
    if (error.code === 'ERR_NETWORK' || error.message.includes('CORS')) {
      return {
        data: {
          items: [
            {
              placeId: 'temp-1',
              name: '임시 혜택 데이터',
              discountPercent: 20,
              popularity: 15,
              address: '서울시 강남구',
              lat: 37.5665,
              lng: 126.978,
            },
          ],
          page: 1,
          pageSize: 20,
          totalPages: 1,
        },
      };
    }

    throw error;
  }
};
```

### vite.config.js (프록시 설정)

```jsx
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      '/api': {
        target: 'https://domo.syu-likelion.org',
        changeOrigin: true,
        secure: false,
      },
    },
  },
});
```

## 🎯 핵심 개념 정리

### CORS (Cross-Origin Resource Sharing)

- **정의**: 브라우저가 다른 도메인 간 요청을 제한하는 보안 정책
- **해결**: 백엔드에서 적절한 CORS 헤더 설정 필요

### Origin 개념

- **구성**: 프로토콜 + 도메인 + 포트
- **HTTP Origin**: `http://localhost:5173`
- **HTTPS Origin**: `https://your-domain.com`
- **차이점**: 보안 정책상 HTTPS가 더 제한적

### 프록시 (Proxy)

- **역할**: 클라이언트와 서버 사이의 중개자
- **장점**: CORS 문제 우회 가능
- **단점**: 개발 환경에서만 사용 가능

### Preflight 요청

- **발생 조건**: POST, PUT 등 복잡한 요청 시
- **목적**: 실제 요청 전 서버 허가 확인
- **요구사항**: OPTIONS 요청에도 CORS 헤더 필요

## ✅ 해결 방안 요약

### 1. 개발 환경 해결책 (임시)

- **프록시 설정**: vite.config.js에 프록시 구성
- **환경별 URL 분리**: 개발/프로덕션 환경 구분
- **임시 데이터**: CORS 에러 시 대체 데이터 제공

### 2. 근본적 해결책 (권장)

- **백엔드 CORS 설정**: 모든 필요한 Origin 허용
- **개발 환경 지원**: HTTP localhost Origins 포함
- **OPTIONS 요청 처리**: Preflight 요청 핸들링

### 3. 백엔드팀 요청사항

```
CORS 설정 요청:
- Access-Control-Allow-Origin: http://localhost:5173, https://your-domain.com
- Access-Control-Allow-Methods: GET, POST, OPTIONS
- Access-Control-Allow-Headers: Content-Type, Accept
- OPTIONS preflight 요청 처리

```

## 🚀 배운 교훈들

### 1. 협업 관점

- API 명세서의 중요성
- 백엔드팀과의 명확한 소통 필요
- 개발 환경 설정 공유의 중요성

### 2. 기술적 관점

- CORS는 브라우저 보안 정책이므로 백엔드에서 해결해야 함
- 프록시는 개발 단계의 임시 해결책
- 환경별 설정 분리의 필요성

### 3. 디버깅 관점

- 브라우저 개발자 도구의 Network 탭 활용
- 상세한 에러 로깅의 중요성
- 단계별 문제 해결 접근법

## 📝 체크리스트

### 개발 시작 전

- [ ] API 명세서 확인
- [ ] 백엔드 서버 상태 확인
- [ ] CORS 설정 논의
- [ ] 개발 환경 설정 공유

### 개발 중

- [ ] 에러 로그 상세 분석
- [ ] 브라우저 네트워크 탭 확인
- [ ] 프록시 설정 구성
- [ ] 임시 데이터 준비

### 배포 전

- [ ] 프로덕션 환경에서 API 테스트
- [ ] CORS 설정 재확인
- [ ] 환경별 설정 검증

---

**📌 결론**

프론트엔드-백엔드 API 연동 시 가장 흔한 문제는 CORS이며, 이는 백엔드 설정으로 해결해야 합니다.

개발 단계에서는 프록시를 활용한 임시 해결책을 사용하되, 궁극적으로는 백엔드팀과의 협력을 통한 근본적 해결이 필요합니다.
