## 번들 분석 (Bundle Analysis)

번들 분석(Bundle Analysis)은 빌드된 번들의 구성과 크기를 시각적으로 확인하여 최적화가 필요한 부분을 찾아내는 과정이에요. 어떤 라이브러리가 번들 크기를 많이 차지하는지, 중복 코드가 있는지 등을 파악할 수 있어요.

## 번들 분석이 필요한 이유

다음과 같은 문제를 발견하고 해결할 수 있어요:

- **큰 라이브러리 발견**: 번들 크기를 많이 차지하는 라이브러리 식별
- **중복 코드 제거**: 여러 청크에 중복 포함된 모듈 찾기
- **사용하지 않는 코드**: 실제로 사용되지 않는데 포함된 코드 확인
- **코드 스플리팅 검증**: 청크가 적절하게 분리되었는지 확인

## Webpack Bundle Analyzer 사용하기

가장 인기 있는 번들 분석 도구는 `webpack-bundle-analyzer`예요.

### 설치하기

```bash
npm install --save-dev webpack-bundle-analyzer
```

### 웹팩 설정에 추가하기

```js
// webpack.config.js
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'static', // 정적 HTML 파일로 생성
      openAnalyzer: true, // 빌드 후 자동으로 브라우저에서 열기
      reportFilename: 'bundle-report.html',
    }),
  ],
};
```

### 빌드 후 리포트 확인하기

```bash
npm run build
```

빌드가 완료되면 브라우저에서 번들 분석 리포트가 자동으로 열려요. 각 모듈이 차지하는 크기를 트리맵으로 시각화해서 보여줘요.

## 분석 모드

### static 모드

정적 HTML 파일을 생성해요. CI/CD 파이프라인에서 사용하기 좋아요.

```js
new BundleAnalyzerPlugin({
  analyzerMode: 'static',
  reportFilename: 'bundle-report.html',
});
```

### server 모드

분석 서버를 실행해서 실시간으로 확인할 수 있어요.

```js
new BundleAnalyzerPlugin({
  analyzerMode: 'server',
  analyzerHost: 'localhost',
  analyzerPort: 8888,
});
```

### disabled 모드

분석 리포트를 생성만 하고 열지는 않아요. JSON 데이터만 필요할 때 사용해요.

```js
new BundleAnalyzerPlugin({
  analyzerMode: 'disabled',
  generateStatsFile: true,
  statsFilename: 'bundle-stats.json',
});
```

## 번들 분석으로 찾을 수 있는 문제들

### 1. 큰 라이브러리 식별

분석 결과를 보면 어떤 라이브러리가 가장 많은 공간을 차지하는지 한눈에 알 수 있어요.

예를 들어, `moment.js`가 너무 크다면 더 가벼운 `day.js`나 `date-fns`로 대체할 수 있어요.

```js
// ❌ moment.js (heavy)
import moment from 'moment';
const date = moment().format('YYYY-MM-DD');

// ✅ day.js (light)
import dayjs from 'dayjs';
const date = dayjs().format('YYYY-MM-DD');
```

### 2. 로케일 파일 제거

`moment.js` 같은 라이브러리는 모든 언어의 로케일 파일을 포함해요. 필요한 것만 선택적으로 포함하면 크기를 크게 줄일 수 있어요.

```js
// webpack.config.js
const webpack = require('webpack');

module.exports = {
  plugins: [
    // 한국어만 포함
    new webpack.ContextReplacementPlugin(/moment[/\\]locale$/, /ko/),
  ],
};
```

### 3. 중복 모듈 제거

같은 라이브러리가 여러 버전으로 중복 포함될 수 있어요. `package.json`을 정리하거나 `resolve.alias`를 사용해 해결할 수 있어요.

```js
// webpack.config.js
module.exports = {
  resolve: {
    alias: {
      react: path.resolve('./node_modules/react'),
    },
  },
};
```

## webpack-stats를 활용한 분석

웹팩의 stats 파일을 생성하고 다양한 온라인 도구로 분석할 수 있어요.

### stats 파일 생성하기

```bash
webpack --profile --json > stats.json
```

또는 웹팩 설정에서:

```js
// webpack.config.js
module.exports = {
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'disabled',
      generateStatsFile: true,
      statsFilename: 'stats.json',
    }),
  ],
};
```

### 온라인 분석 도구

생성된 `stats.json` 파일을 다음 사이트에 업로드하여 분석할 수 있어요:

- **Webpack Visualizer**: https://chrisbateman.github.io/webpack-visualizer/
- **Webpack Analyse**: https://webpack.github.io/analyse/
- **Bundle Size**: https://bundlesize.io/

## 번들 크기 모니터링

### 1. bundlesize 라이브러리

CI/CD에서 번들 크기를 자동으로 체크할 수 있어요.

```bash
npm install --save-dev bundlesize
```

```json
// package.json
{
  "bundlesize": [
    {
      "path": "./dist/bundle.js",
      "maxSize": "300 KB"
    }
  ]
}
```

```bash
# 번들 크기 체크
npx bundlesize
```

### 2. GitHub Actions에서 사용하기

```yaml
# .github/workflows/bundlesize.yml
name: Bundlesize Check
on: [pull_request]

jobs:
  bundlesize:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm ci
      - run: npm run build
      - run: npx bundlesize
```

## 최적화 체크리스트

번들 분석 결과를 바탕으로 다음 항목들을 확인하세요:

### ✅ 라이브러리 최적화

- [ ] 큰 라이브러리를 더 가벼운 대안으로 교체
- [ ] 불필요한 로케일 파일 제거
- [ ] Tree shaking이 적용되는 ES6 모듈 버전 사용

### ✅ 코드 스플리팅

- [ ] 페이지별로 청크가 분리되어 있는지 확인
- [ ] vendor 코드가 별도 청크로 분리되어 있는지 확인
- [ ] 동적 import가 적용되어 있는지 확인

### ✅ 중복 제거

- [ ] 같은 라이브러리가 여러 번 포함되지 않았는지 확인
- [ ] 공통 모듈이 각 청크마다 중복되지 않았는지 확인

### ✅ 압축

- [ ] 프로덕션 빌드에서 minification 적용
- [ ] Gzip 또는 Brotli 압축 활성화

## 실전 예제

```js
// webpack.config.js
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');
const CompressionPlugin = require('compression-webpack-plugin');

module.exports = {
  mode: 'production',

  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10,
        },
      },
    },
  },

  plugins: [
    // 번들 분석
    new BundleAnalyzerPlugin({
      analyzerMode: process.env.ANALYZE ? 'server' : 'disabled',
    }),

    // Gzip 압축
    new CompressionPlugin({
      algorithm: 'gzip',
      test: /\.(js|css|html|svg)$/,
    }),
  ],
};
```

```json
// package.json
{
  "scripts": {
    "build": "webpack --mode production",
    "analyze": "ANALYZE=true webpack --mode production"
  }
}
```

이제 `npm run analyze` 명령으로 번들을 분석하고, `npm run build`로 최적화된 빌드를 생성할 수 있어요.

## 마무리

번들 분석을 통해 다음을 달성할 수 있어요:

- 초기 로딩 속도 개선
- 불필요한 코드 제거
- 효율적인 캐싱 전략 수립
- 지속적인 성능 모니터링

정기적으로 번들을 분석하고 최적화하여 최상의 사용자 경험을 제공하세요!
