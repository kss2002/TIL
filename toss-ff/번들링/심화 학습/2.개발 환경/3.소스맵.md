## 소스맵 (Source Map)

소스맵(Source Map)은 변환되거나 압축된 코드를 원본 소스 코드와 매핑해주는 파일이에요. 브라우저 개발자 도구에서 실제 작성한 코드를 디버깅할 수 있게 도와줘요.

## 소스맵이 필요한 이유

웹팩으로 번들링하면 여러 파일이 하나로 합쳐지고, Babel로 트랜스파일하면 코드가 변환돼요. 또한 프로덕션 빌드에서는 코드가 압축(minify)되어 읽기 어려워져요.

예를 들어, 다음과 같은 원본 코드가:

```js
// src/utils/math.js
export function add(a, b) {
  return a + b;
}

// src/index.js
import { add } from './utils/math';
console.log(add(1, 2));
```

번들링 후에는 이렇게 변해요:

```js
(() => {
  'use strict';
  console.log(1 + 2);
})();
```

이런 상태에서 에러가 발생하면 원본 코드의 어느 부분에서 문제가 생겼는지 파악하기 어려워요. 소스맵은 변환된 코드와 원본 코드를 연결해서 이 문제를 해결해요.

## 소스맵 설정하기

웹팩에서는 `devtool` 옵션으로 소스맵을 설정할 수 있어요.

```js
// webpack.config.js
module.exports = {
  devtool: 'source-map',
};
```

## 주요 devtool 옵션

소스맵 생성 방식에 따라 빌드 속도와 디버깅 품질이 달라져요.

### eval (개발용)

각 모듈을 `eval()` 함수로 감싸서 실행해요. 빌드가 가장 빠르지만, 정확한 줄 번호를 제공하지 않아요.

```js
module.exports = {
  devtool: 'eval',
};
```

### source-map (프로덕션용)

별도의 `.map` 파일을 생성해요. 빌드는 느리지만 가장 정확한 소스맵을 제공해요.

```js
module.exports = {
  devtool: 'source-map',
};
```

### inline-source-map (개발용)

소스맵을 번들 파일 내부에 DataURL로 포함해요. 파일 크기가 커지지만 별도 파일 관리가 필요 없어요.

```js
module.exports = {
  devtool: 'inline-source-map',
};
```

### eval-source-map (개발용)

`eval`과 `source-map`을 결합한 방식이에요. 빌드 속도도 빠르고 디버깅 품질도 좋아서 개발 환경에서 추천돼요.

```js
module.exports = {
  devtool: 'eval-source-map',
};
```

### cheap-module-source-map (개발용)

컬럼 정보를 제외하고 줄 번호만 매핑해요. 빌드 속도가 빠르면서도 충분한 디버깅 정보를 제공해요.

```js
module.exports = {
  devtool: 'cheap-module-source-map',
};
```

## 환경별 추천 설정

### 개발 환경

빠른 빌드와 정확한 디버깅을 위해 `eval-source-map` 또는 `cheap-module-source-map`을 추천해요.

```js
// webpack.config.js
module.exports = {
  mode: 'development',
  devtool: 'eval-source-map',
};
```

### 프로덕션 환경

프로덕션에서는 두 가지 선택지가 있어요:

1. **소스맵 제공**: 에러 추적이 중요하다면 `source-map` 사용
2. **소스맵 미제공**: 보안이 중요하다면 `false` 또는 생략

```js
// webpack.config.js
module.exports = {
  mode: 'production',
  devtool: 'source-map', // 또는 false
};
```

```참고
프로덕션 환경에서 소스맵 보안

프로덕션에서 소스맵을 제공하면 사용자가 원본 소스 코드를 볼 수 있어요. 보안이 중요한 경우 다음 방법을 고려하세요:

1. **소스맵 미제공**: `devtool: false`로 설정
2. **서버에만 저장**: 소스맵을 배포하지 않고 에러 모니터링 서비스에만 업로드
3. **hidden-source-map**: 소스맵은 생성하되 번들에 참조를 추가하지 않음
```

## 소스맵 파일 구조

생성된 소스맵 파일(`.map`)은 다음과 같은 구조를 가져요:

```json
{
  "version": 3,
  "sources": ["webpack://my-app/src/index.js"],
  "names": ["console", "log"],
  "mappings": "AAAA,QAAQ,GAAG",
  "file": "bundle.js",
  "sourceRoot": ""
}
```

- `sources`: 원본 파일 경로
- `names`: 원본 변수/함수 이름
- `mappings`: 실제 매핑 정보 (Base64 VLQ 인코딩)

## 브라우저에서 소스맵 사용하기

브라우저 개발자 도구는 자동으로 소스맵을 인식해요. 번들 파일 마지막에 있는 주석을 통해 소스맵 파일을 찾아요.

```js
// bundle.js
(() => {
  'use strict';
  console.log(3);
})();
//# sourceMappingURL=bundle.js.map
```

Chrome DevTools에서 소스맵이 활성화되어 있으면:

1. Sources 탭에서 원본 파일 구조를 볼 수 있어요
2. 에러 스택 트레이스가 원본 파일 위치를 가리켜요
3. 브레이크포인트를 원본 코드에 설정할 수 있어요

## 다음 단계

개발 환경 설정을 모두 완료했어요! 이제 번들 크기를 최적화하는 방법을 배워볼게요.
