## HMR (Hot Module Replacement)

HMR(Hot Module Replacement)은 애플리케이션이 실행 중인 상태에서 수정된 모듈만 교체하는 기술이에요. 전체 페이지를 새로고침하지 않고도 최신 코드를 반영할 수 있어 개발 생산성이 크게 향상돼요.

## HMR이 필요한 이유

일반적인 개발 과정에서는 코드를 수정할 때마다 브라우저를 새로고침해야 해요. 하지만 이렇게 하면 다음과 같은 문제가 발생해요:

- 애플리케이션의 현재 상태가 초기화돼요
- 특정 상태를 재현하기 위해 여러 단계를 다시 거쳐야 해요
- 새로고침 시간이 낭비돼요

HMR을 사용하면 애플리케이션 상태를 유지한 채로 변경된 코드만 즉시 반영할 수 있어요.

## HMR 설정하기

### 웹팩 설정

`webpack-dev-server`에서 HMR을 활성화하려면 `hot` 옵션을 `true`로 설정하면 돼요.

```js
// webpack.config.js
module.exports = {
  devServer: {
    hot: true,
  },
};
```

웹팩 5부터는 `hot: true` 설정만으로도 HMR이 자동으로 활성화돼요.

### React에서 HMR 사용하기

React 프로젝트에서 HMR을 사용하려면 `react-refresh-webpack-plugin`을 설치해야 해요.

```bash
npm install -D @pmmmwh/react-refresh-webpack-plugin react-refresh
```

웹팩 설정에 플러그인을 추가해요:

```js
// webpack.config.js
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

module.exports = {
  mode: 'development',
  devServer: {
    hot: true,
  },
  plugins: [new ReactRefreshWebpackPlugin()],
  module: {
    rules: [
      {
        test: /\.(js|jsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-react'],
            plugins: ['react-refresh/babel'],
          },
        },
      },
    ],
  },
};
```

## HMR 동작 원리

HMR은 다음과 같은 과정으로 동작해요:

1. **파일 변경 감지**: 개발 서버가 파일 시스템을 모니터링하다가 변경을 감지해요
2. **모듈 재컴파일**: 변경된 모듈만 다시 컴파일해요
3. **업데이트 전송**: WebSocket을 통해 브라우저에 업데이트 정보를 전송해요
4. **모듈 교체**: 브라우저에서 HMR 런타임이 변경된 모듈을 교체해요
5. **상태 유지**: 애플리케이션 상태를 유지하면서 UI만 업데이트해요

```
파일 변경 → 재컴파일 → WebSocket 전송 → 모듈 교체 → UI 업데이트
```

## HMR API 사용하기

커스텀 HMR 처리가 필요한 경우 `module.hot` API를 사용할 수 있어요.

```js
// index.js
import { render } from './app';

render();

// HMR 코드
if (module.hot) {
  module.hot.accept('./app', () => {
    // app.js가 변경되면 이 콜백이 실행돼요
    render();
  });
}
```

이 코드는 `app.js` 파일이 변경될 때마다 `render()` 함수를 다시 호출해요.

## HMR과 CSS

CSS는 특별한 설정 없이도 HMR이 잘 작동해요. `style-loader`가 기본적으로 HMR을 지원하기 때문이에요.

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
};
```

CSS 파일을 수정하면 페이지 새로고침 없이 즉시 스타일이 변경되는 것을 확인할 수 있어요.

## HMR 제한사항

HMR이 모든 상황에서 완벽하게 작동하는 것은 아니에요. 다음과 같은 경우에는 전체 새로고침이 필요할 수 있어요:

- 진입점(Entry Point) 파일이 변경된 경우
- 웹팩 설정 파일이 변경된 경우
- HMR이 실패한 경우 (fallback으로 전체 새로고침)

```참고
HMR vs Live Reload

**Live Reload**는 파일 변경 시 전체 페이지를 새로고침하는 방식이에요. 간단하지만 애플리케이션 상태가 초기화돼요.

**HMR**은 변경된 모듈만 교체하여 상태를 유지해요. 더 복잡하지만 개발 경험이 훨씬 좋아요.
```

## 다음 단계

HMR을 이해했다면, 이제 디버깅을 위한 소스맵(Source Map)에 대해 알아볼게요.
